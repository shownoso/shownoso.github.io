(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{210:function(s,t,a){"use strict";a.r(t);var e=a(0),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"travis-ci"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#travis-ci"}},[s._v("#")]),s._v(" Travis CI")]),s._v(" "),a("p",[s._v("一个提供持续集成服务，用于测试和部署的自动化的工具。")]),s._v(" "),a("h2",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("ol",[a("li",[s._v("进入"),a("a",{attrs:{href:"https://www.travis-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方网站"),a("OutboundLink")],1),s._v("，使用 github 账号登录。")]),s._v(" "),a("li",[s._v("选择需要同步到 Travis 的 github 仓库，Travis 将根据配置监听它们并执行任务。")]),s._v(" "),a("li",[s._v("选择一个仓库，在 settings（More options） 面板中进行项目配置：\n"),a("ul",[a("li",[s._v("General：选择触发任务的时机，比如勾选 Build pushed branches 表示推送时触发构建")]),s._v(" "),a("li",[s._v("Environment Variables：设置执行任务时的环境变量")])])])]),s._v(" "),a("h2",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),a("p",[s._v("在项目根目录下创建 "),a("code",[s._v(".travis.yml")]),s._v("，通过该配置文件告知 travis 需要执行的具体任务流程。以下是一个 github pages "),a("a",{attrs:{href:"https://docs.travis-ci.com/user/deployment/",target:"_blank",rel:"noopener noreferrer"}},[s._v("快捷部署"),a("OutboundLink")],1),s._v("的参考配置：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("language")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_js\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_js")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" lts/*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("install")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm install \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("build\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provider")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pages "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署到 github pages， 会自动创建 gh-pages 分支")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("skip_cleanup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("local_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docs/.vuepress/dist "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要推送的本地目录")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target-branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送的目标仓库分支")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" shownoso/shownoso.github.io "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送的目标仓库")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("github_token")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $GITHUB_TOKEN "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于允许 Travis 向你的仓库推送代码。在 GitHub 中生成，在 Travis 的项目设置页面进行配置")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("keep_history")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地项目的master分支")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"github-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-token"}},[s._v("#")]),s._v(" github_token")]),s._v(" "),a("p",[s._v("为了完成 "),a("code",[s._v("deploy")]),s._v(" 任务，Travis 需要获得一些必要权限，用于代码拉取、推送等操作，因此，在 github 配置一个 "),a("code",[s._v("Personal access token")]),s._v("。")]),s._v(" "),a("ul",[a("li",[s._v("在 github 主页点击个人头像，进入 Settings-Developer -> settings -> Personal access tokens 面板，点击 Generate new token 选择需要的权限并生成新的 token。")]),s._v(" "),a("li",[s._v("复制这个 token，回到 Travis 项目配置页，在 Environment Variables 中添加一个环境变量 "),a("code",[s._v("GITHUB_TOKEN")]),s._v("，值为该 token。该环境变量将在 Travis 执行任务时生效。")])]),s._v(" "),a("h3",{attrs:{id:"travis-任务的生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#travis-任务的生命周期"}},[s._v("#")]),s._v(" Travis 任务的生命周期")]),s._v(" "),a("ol",[a("li",[s._v("before_install 安装依赖前")]),s._v(" "),a("li",[s._v("install 安装依赖时")]),s._v(" "),a("li",[s._v("before_script 执行脚本前")]),s._v(" "),a("li",[s._v("script 执行脚本时")]),s._v(" "),a("li",[s._v("after_success 或 after_failure 执行脚本成功（失败）后")]),s._v(" "),a("li",[s._v("before_deploy 部署前")]),s._v(" "),a("li",[s._v("deploy 部署时")]),s._v(" "),a("li",[s._v("after_deploy 部署后")]),s._v(" "),a("li",[s._v("after_script 执行脚本后")])]),s._v(" "),a("h3",{attrs:{id:"大致如此"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大致如此"}},[s._v("#")]),s._v(" 大致如此")]),s._v(" "),a("ul",[a("li",[s._v("将 github 中的 test 项目同步到 Travis CI，当满足触发自动构建的条件时，Travis 将根据 test 项目根目录下的 "),a("code",[s._v(".travis.yml")]),s._v(" 执行任务。")]),s._v(" "),a("li",[s._v("需要格外注意的是服务器的访问权限，因此对于远程服务器需要配置"),a("RouterLink",{attrs:{to:"/blog/SSH_Login.html"}},[s._v("免密登录")]),s._v("。")],1)]),s._v(" "),a("h2",{attrs:{id:"加密与安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加密与安全"}},[s._v("#")]),s._v(" 加密与安全")]),s._v(" "),a("ol",[a("li",[s._v("加密一段文本"),a("br"),s._v("\n在 Environment Variables 中配置了环境变量 "),a("code",[s._v("GITHUB_TOKEN")]),s._v("，它的值在 Travis 网站是明文保存的，可以使用 "),a("code",[s._v("travis encrypt")]),s._v(" 对其进行加密。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 travis")]),s._v("\ngem "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" travis\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# GITHUB_TOKEN： 环境变量名； token：github中配置的`Personal access token`")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将得到一串加密的文本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --add 将输出自动添加到当前目录的 `.travis.yml`")]),s._v("\ntravis encrypt "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GITHUB_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("token --add\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("在 "),a("code",[s._v(".travis.yml")]),s._v(" 使用加密文本")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"加密文本"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("加密一个文件"),a("br"),s._v("\n例如，当希望 Travis 免密登录服务器时，可以使用 "),a("code",[s._v("travis encrypt-file")]),s._v(" 对服务器的私钥进行加密")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这将在根目录创建 id_rsa.enc")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# travis 会给出提示 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将私钥加密后的 id_rsa.enc 提交到仓库而不是将私钥 id_rsa 本身提交到仓库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --add 将输出自动添加到当前目录的 `.travis.yml` -> before_install")]),s._v("\ntravis encrypt-file ~/.ssh/id_rsa --add\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])])])}),[],!1,null,null,null);t.default=n.exports}}]);